{% extends "layouts/base.html" %}

{% block content %}
{% include("partials/sub_nav_contacts.html") %}

<div id="contact-view" class="content-normal">
  
{% if result.contact %}

  <div class="clearfix">
    <img class="contact-avatar left" width="80" src="{{ show_avatar(result.contact.photo.0) }}">
    <h2  class="contact-name ">{{ result.contact.fn }}</h2>
    <h5 class="contact-subname">Hey, that's you :)</h5>
  </div>
  <hr>
 
  <h4>Emails</h4>
  <ul>
  {% if result.contact.email %}
    {% for email in result.contact.email %}
    <li><a class="compose-to-email" href="/contact/{{ email.email|e }}">{{email.email}}</a></li>
    {% endfor %}
  {% endif %}
  </ul>
  <hr>

  <h4>Stats</h4>
  <ul>
    <li>Messages sent to contact: {{result.sent_messages}}</li>
    <li>Messages received from contact: {{result.received_messages}}</li>
    {% if result.last_contact_to %}
    <li>Last contacted on: <a href="{{result.last_contact_to_msg_url}}">{{result.last_contact_to}}</a></li>
    {% else %}
    <li>You've never contacted this contact.</li>
    {% endif %}
    {% if result.last_contact_from %}
    <li>Last contacted you on <a href="{{result.last_contact_from_msg_url}}">{{friendly_datetime(result.last_contact_from)}}</a></li>
    {% else %}
    <li>You've never been contacted by this contact.</li>
    {% endif %}
  </ul>
  <hr>  

  <h4><span class="icon-inbox"></span> Conversations</h4>
  
  {% set contact_search = "email:" + result.contact.email.0.email %}
  {% set contact_messages = mailpile("search", contact_search).result %}

  {% if contact_messages %}
  <ul>
    {% for mid in contact_messages.thread_ids %}
      <li><a href="/thread/={{ mid }}/">{{ contact_messages.data.metadata[mid].subject }} ({{ contact_messages.data.threads[mid]|length }})</a></li>
    {% endfor %}  
  </ul>
  {% endif %}
  

{% else %}

    {% set error_title = "contact_missing" %}
    {% include("partials/errors_content.html") %}

{% endif %}

</div>

{% endblock %}