{% extends "layouts/base.html" %}
{% block content %}

{# Macros are simple methods used by Jinja for repeating HTML blocks #}
{% macro render_thread_metadata(metadata, from, profiles, crypto=false) -%}
<div class="thread-item-metadata clearfix">
  <div class="thread-item-from-avatar">
    <a href="{{ contact_url(from) }}" title="{{_("From")}}"><img src="{{ show_avatar(from) }}"></a>
  </div>
  <div class="thread-item-from">
    <a href="{{ contact_url(from) }}" class="name" title="{{_("From")}}">{{ contact_name(profiles, from) }}</a>
    <div class="thread-item-metadata-icons">
      {% if crypto %}
      <span class="icon {{ show_message_signature(crypto.signature.status) }}" data-expand="no"></span>
      <span class="icon {{ show_message_encryption(crypto.encryption.status) }}" data-expand="no"></span>
      {% else %}
      <span class="icon {{ show_message_signature(metadata.crypto.signature) }}" data-expand="no"></span>
      <span class="icon {{ show_message_encryption(metadata.crypto.encryption) }}" data-expand="no"></span>
      {% endif %}
      <span class="show-thread-message-metadata-details icon icon-circle-info" data-expand="no"></span>
    </div>
  </div>
  <div class="thread-item-details">
    <a class="datetime" href="{{ metadata.urls.thread }}">{{ metadata.timestamp|friendly_datetime }} at {{ metadata.timestamp|friendly_time }}</a>
    <span class="feedback-expand"><span class="icon-expand"></span> {{_("Expand Message")}}</span>
  </div>
</div>
{%- endmacro %}

{% macro render_contact_item(person, profiles) -%}
<li class="thread-item-metadata-contact">
  <a href="{{ contact_url(person) }}" title="{{person.address}}"><img src="{{ show_avatar(person) }}"></a>
  <a href="{{ contact_url(person) }}" title="{{person.address}}">{{ contact_name(profiles, person) }}</a>
</li>
{%- endmacro %}

{% if result %}
  {% set profiles = mailpile('settings', 'profiles').result.profiles %}
  {% set showed_composer = [] %}
  {% for mid in result.thread_ids|reverse %}
    {% if mid in result.data.messages %}
      {% set metadata = result.data.metadata[mid] %}
      {% set message  = result.data.messages[mid] %}
      {% include("partials/thread_message.html") %}
    {% endif %}
  {% endfor %}
{% else %}
  {% set error_title = "message_missing" %}
  {% include("partials/errors_content.html") %}
{% endif  %}{# if result #}
{% endblock %}
