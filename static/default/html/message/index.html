{% extends "layouts/base.html" %}

{% block content %}
{% include("partials/sub_nav_view.html") %}

{% if result %}

<table class="pile-results" id="pile-results">
  <tbody>

    {% for message in result.0.messages %}
    {% if message.message %}
		<tr>
      <td class="message-body" colspan="4">
      {% if not message.editing_string %}
        <ul class="message-headers">
          <li><b>Date:</b> {{message.date}}</li>
          <li><b>From:</b> {{message.from|e}}</li>
          <li><b>To:</b> {% for toaddr in message.to %}<a class="emailaddr" href="/contact/{{toaddr}}/" style="background: #eee; border-radius: 3px; padding: 2px; padding-left: 4px; padding-right: 4px; font-weight: normal;">{{toaddr}}</a>{% if not loop.last %}, {% endif %}{% endfor %}</li>
          <li><b>Cc:</b> {% for ccaddr in message.cc %}<a class="emailaddr" href="/contact/{{ccaddr}}/" style="background: #eee; border-radius: 3px; padding: 2px; padding-left: 4px; padding-right: 4px; font-weight: normal;">{{ccaddr}}</a>{% if not loop.last %}, {% endif %}{% endfor %}</li>
          <li><b>Bcc:</b> {% for bccaddr in message.bcc %}<a class="emailaddr" href="/contact/{{bccaddr}}/" style="background: #eee; border-radius: 3px; padding: 2px; padding-left: 4px; padding-right: 4px; font-weight: normal;">{{bccaddr}}</a>{% if not loop.last %}, {% endif %}{% endfor %}</li>
          <li><b>Subject:</b> {{message.subject}}</li>
        </ul>
       
       <div class="message-body">
       {% for part in message.message.text_parts %}
         <p class="text-part-{type}">{{part.data|replace("\n", "<br/>")}}</p>
       {% endfor %}
       {% for part in message.message.html_parts %}
         <p class="html-part-{type}">{{part.data|safe}}</p>
       {% endfor %}
       </div>
       <ul class="message-attachments">
       {% for att in message.message.attachments %}
         <li><a href="./att:{{att.count}}" type="{{att.mimetype}}">{{att.filename}}</a>({{att.mimetype}} {{att.length}} bytes)</li>
       {% endfor %}
       </ul>
     <a href="/message/reply/={{message.idx}}" class="button-secondary"><span class="icon-reply"></span> Reply</a> 
     <a href="/message/forward/={{message.idx}}" class="button-secondary"><span class="icon-forward"></span> Forward</a> 
     <a href="/message/archive/={{message.idx}}" class="button-secondary"><span class="icon-archive"></span> Archive</a>
     <a href="/message/remove/={{message.idx}}" class="button-secondary"><span class="icon-trash"></span> Delete</a>
     {% endif %}
     </td>
   </tr>
   {% else %}
   <tr class="result {{message.even_odd}} {% if message.is_editable %}is_editable{% endif %} {{message.tag_classes}}" data-state="normal">
     <td class="from" title='{% for p in message.conv_people %} {{p.name}} &lt;{{p.email}}&gt;{% endfor %}'>
       <a href="{{message.url}}{% if message.is_editable %}edit.html{% endif %}">{{message.short_from}}</a>
     </td>
     <td class="subject">
       <a href="{{message.url}}{% if message.is_editable %}edit.html{% endif %}">{{message.subject}}</a>
     </td>
     <td class="date" valign="top">
       <a href="/_/search/dates:{date}">{{message.friendly_date}}</a>
     </td>
     <td class="checkbox" valign="top">
       <input type="checkbox" name="msg_{idx}" value="normal">
     </td>
     {% endif %}
  </tr>
  {% endfor %}
</tbody>
</table>

{% else %}

<div id="error" class="content-normal">
  <h3>Oops, you've found a quirk!</h3>
  <p>For some reason, we were unable to find the message you requested. This means the message was either deleted or it is a bug with Mailpile.</p>
  <p>If you think this is a bug, please file <a href="https://github.com/pagekite/Mailpile/issues" target="_blank">a bug report</a>. Have a good day :)</p>
</div>

{% endif %}

{% include("partials/details_search_speed.html") %}
{% endblock %}
